---
// å¼•å…¥ Svelte ç»„ä»¶
import ElmWrapper from '../components/ElmWrapper.svelte';
import { S3Client, ListObjectsV2Command } from "@aws-sdk/client-s3";
import postgres from 'postgres';

// --- SSR æœåŠ¡ç«¯é€»è¾‘åŒº ---

// ç”Ÿæˆéšæœºç›®æ ‡æ•°å­— (7-15)
const targetNumber = Math.floor(Math.random() * 9) + 7;

// 1. æµ‹è¯•è¿æ¥ Neon æ•°æ®åº“
const sql = postgres(import.meta.env.DATABASE_URL);
// å‡è®¾ä½ æ•°æ®åº“é‡Œæœ‰ä¸ªå« posts çš„è¡¨ï¼Œæ²¡æœ‰çš„è¯è¿™è¡Œä¼šæŠ¥é”™ï¼Œå…ˆæ³¨é‡Šæ‰æµ‹è¯•
// const posts = await sql`select * from posts`;

// 2. æµ‹è¯•è¿æ¥ C2 å­˜å‚¨
const s3 = new S3Client({
  region: import.meta.env.S3_REGION,
  endpoint: import.meta.env.S3_ENDPOINT,
  credentials: {
    accessKeyId: import.meta.env.S3_ACCESS_KEY,
    secretAccessKey: import.meta.env.S3_SECRET_KEY,
  },
});

// å¦‚æœæˆåŠŸï¼Œè¿”å›æ•°ç»„ï¼›å¦‚æœå¤±è´¥ï¼Œæ‰“å°é”™è¯¯å¹¶è¿”å›ç©ºæ•°ç»„
const files = await s3
  .send(new ListObjectsV2Command({ Bucket: import.meta.env.S3_BUCKET }))
  .then((res) => res.Contents || [])
  .catch((err) => {
    console.error("S3 è¿æ¥å¤±è´¥:", err);
    return []; // å‘ç”Ÿé”™è¯¯æ—¶çš„é»˜è®¤å€¼
  });

// å°è¯•åˆ—å‡ºæ–‡ä»¶
// const command = new ListObjectsV2Command({ Bucket: import.meta.env.S3_BUCKET });
// const files = await s3.send(command);
---

<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>æˆ‘çš„å…¨æ ˆåšå®¢</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				min-height: 100vh;
				padding: 2rem;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			}
			h1, p {
				color: white;
				text-align: center;
				margin-bottom: 1.5rem;
			}
			h1 {
				font-size: 2.5rem;
				margin-bottom: 1rem;
			}
			p {
				font-size: 1.1rem;
				margin-bottom: 2rem;
			}
			.links-section {
				margin-top: 3rem;
				padding-top: 2rem;
				border-top: 2px solid rgba(255, 255, 255, 0.2);
				width: 100%;
				max-width: 600px;
			}
			.links-title {
				font-size: 1.3rem;
				margin-bottom: 1.5rem;
				color: white;
				text-align: center;
			}
			.links-container {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 1rem;
			}
			.link-card {
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 8px;
				padding: 1.2rem;
				text-align: center;
				transition: all 0.3s ease;
				text-decoration: none;
				color: white;
				backdrop-filter: blur(10px);
			}
			.link-card:hover {
				background: rgba(255, 255, 255, 0.2);
				transform: translateY(-5px);
				box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
				border-color: #ffd700;
			}
			.link-name {
				font-weight: bold;
				font-size: 1.1rem;
				margin-bottom: 0.5rem;
				color: #ffd700;
			}
			.link-desc {
				font-size: 0.9rem;
				color: rgba(255, 255, 255, 0.8);
			}
		</style>
	</head>
	<body>
		<h1>Astro + Svelte + Elm</h1>
		
		<p>å°†è®¡æ•°å™¨åŠ åˆ° <span style="color: #ffd700; font-weight: bold;">{targetNumber}</span> æ¥è®¿é—®ä¸ªäººä¸»é¡µ</p>
		
		<!-- client:load æ„æ€æ˜¯ï¼šé¡µé¢åŠ è½½æ—¶ç«‹å³åœ¨å®¢æˆ·ç«¯æ¿€æ´» JS -->
		<!-- å¦‚æœä¸åŠ  client:loadï¼Œå®ƒå°±æ˜¯é™æ€ HTMLï¼ŒElm åŠ¨ä¸äº† -->
		<ElmWrapper targetNumber={targetNumber} client:load />

		<!-- å‹é“¾åŒºåŸŸ -->
		<div class="links-section">
			<h2 class="links-title">ğŸ”— å‹æƒ…é“¾æ¥</h2>
			<div class="links-container">
				<a href="https://tool.nexur.top" target="_blank" rel="noopener noreferrer" class="link-card">
					<div class="link-name">OpenDevTools</div>
					<div class="link-desc">ODå·¥å…·ç®±</div>
				</a>
			</div>
		</div>

	</body>
</html>


