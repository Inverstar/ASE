---
// 引入 Svelte 组件
import ElmWrapper from '../components/ElmWrapper.svelte';
import { S3Client, ListObjectsV2Command } from "@aws-sdk/client-s3";
import postgres from 'postgres';

// --- SSR 服务端逻辑区 ---

// 1. 测试连接 Neon 数据库
const sql = postgres(import.meta.env.DATABASE_URL);
// 假设你数据库里有个叫 posts 的表，没有的话这行会报错，先注释掉测试
// const posts = await sql`select * from posts`;

// 2. 测试连接 C2 存储
const s3 = new S3Client({
  region: import.meta.env.S3_REGION,
  endpoint: import.meta.env.S3_ENDPOINT,
  credentials: {
    accessKeyId: import.meta.env.S3_ACCESS_KEY,
    secretAccessKey: import.meta.env.S3_SECRET_KEY,
  },
});

// 如果成功，返回数组；如果失败，打印错误并返回空数组
const files = await s3
  .send(new ListObjectsV2Command({ Bucket: import.meta.env.S3_BUCKET }))
  .then((res) => res.Contents || [])
  .catch((err) => {
    console.error("S3 连接失败:", err);
    return []; // 发生错误时的默认值
  });

// 尝试列出文件
// const command = new ListObjectsV2Command({ Bucket: import.meta.env.S3_BUCKET });
// const files = await s3.send(command);
---

<html lang="en">
	<head>
		<title>我的全栈博客</title>
	</head>
	<body>
		<h1>Astro + Svelte + Elm</h1>
		
		<p>下面是一个嵌入的 Elm 计数器：</p>
		
		<!-- client:load 意思是：页面加载时立即在客户端激活 JS -->
		<!-- 如果不加 client:load，它就是静态 HTML，Elm 动不了 -->
		<ElmWrapper client:load />

	</body>
</html>


